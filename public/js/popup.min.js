import{getBlocklist,getIsWhitelist,getActiveTab}from"./controller.min.js";import{ExtPay}from"../assets/ExtPay/ExtPay.min.js";const extpay=ExtPay("nomoresurf"),pricingBtn=document.getElementById("pricingBtn"),blockSiteBtn=document.getElementById("blockSiteBtn"),editBlocklistBtn=document.getElementById("editBlocklistBtn");let activeTab=null,targetURL=null,blocklist=[],isWhitelist=!1;async function init(){extpay.getUser().then((t=>{t.paid||pricingBtn.classList.remove("invisible")})),activeTab=await getActiveTab(),targetURL=new URL(activeTab.url),"http:"!=targetURL.protocol&&"https:"!=targetURL.protocol?(blockSiteBtn.innerText="This site cannot be blocked",blockSiteBtn.disabled=!0):(blocklist=await getBlocklist(),isWhitelist=await getIsWhitelist(),blocklist.includes(targetURL.hostname)&&!isWhitelist||!blocklist.includes(targetURL.hostname)&&isWhitelist?(blockSiteBtn.innerText="This site is already blocked",blockSiteBtn.disabled=!0):(blockSiteBtn.innerHTML=`Block <span class="text-lowercase">${targetURL.hostname}</span>`,blockSiteBtn.addEventListener("click",(()=>{if(isWhitelist){let t=blocklist.indexOf(targetURL.hostname);blocklist.splice(t,1)}else blocklist.push(targetURL.hostname);chrome.storage.sync.set({blocklist:blocklist}),window.close()}))))}init(),editBlocklistBtn.addEventListener("click",(()=>{chrome.runtime.openOptionsPage((()=>{chrome.runtime.sendMessage({action:"openBlocklistTab"})}))})),pricingBtn.addEventListener("click",(t=>{t.preventDefault(),chrome.tabs.query({url:chrome.runtime.getURL("options.html")},(t=>{t.length>0?chrome.runtime.openOptionsPage((()=>{chrome.runtime.sendMessage({action:"openPricingTab"})})):window.open(chrome.runtime.getURL("options.html#pricing"))}))}));